<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUNLET í†µí•© ê´€ë¦¬ì V2</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background: #111; color: white; font-family: 'Noto Sans KR'; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { width: 500px; background: #222; padding: 30px; border-radius: 20px; box-shadow: 0 0 20px rgba(0,255,157,0.2); border: 1px solid #333; }
        h2 { text-align: center; color: #00ff9d; margin-bottom: 30px; }
        
        .section { margin-bottom: 25px; padding: 15px; background: #2a2a2a; border-radius: 10px; border: 1px solid #444; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #ccc; font-size: 0.9rem; }
        input, select { width: 100%; padding: 12px; background: #111; border: 1px solid #555; color: white; border-radius: 8px; box-sizing: border-box; margin-bottom: 10px; }
        
        button { width: 100%; padding: 15px; background: #00ff9d; color: black; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        button:hover { background: #00cc7d; }
        
        .status { margin-top: 20px; padding: 15px; background: #333; border-radius: 8px; font-size: 0.9rem; color: #aaa; word-break: break-all; display: none; }
        
        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 10px; background: #333; border: none; color: #aaa; cursor: pointer; border-radius: 8px; }
        .tab.active { background: #00ff9d; color: black; font-weight: bold; }
        
        .helper-text { font-size: 0.8rem; color: #888; margin-top: -5px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ”§ FUNLET ë§ˆìŠ¤í„° ê´€ë¦¬ì</h2>

        <div class="form-group">
            <label>ğŸ”‘ ê´€ë¦¬ì í† í° (ì €ì¥ë¨)</label>
            <input type="password" id="token" placeholder="ghp_..." onchange="saveToken()">
        </div>

        <div class="tabs">
            <button class="tab active" onclick="setMode('overwrite')">ğŸ”„ êµì²´ (ë°°ë„ˆ/ì¸ë„¤ì¼)</button>
            <button class="tab" onclick="setMode('new')">â• ì‹ ê·œ ì¶”ê°€</button>
        </div>

        <div class="section">
            <label>ğŸ“‚ ì–´ë””ì— ì˜¬ë¦´ê¹Œìš”?</label>
            <select id="folderList" onchange="updatePresets()">
                <option value="">í´ë” ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</option>
            </select>
            <button onclick="loadFolders()" style="padding: 5px; font-size: 0.8rem; background: #444; color: white; margin-top: 5px;">í´ë” ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <div class="section" id="overwriteSection">
            <label>ğŸ¯ ë¬´ì—‡ì„ ë°”ê¿€ê¹Œìš”? (íŒŒì¼ëª… ìë™ ê³ ì •)</label>
            <select id="filePreset" onchange="applyPreset()">
                <option value="">-- ì§ì ‘ ì…ë ¥ --</option>
                </select>
            <input type="text" id="targetFileName" placeholder="ì˜ˆ: banner_main.png" style="background:#000; border-color:#00ff9d;">
            <p class="helper-text">â€» ì´ ì´ë¦„ìœ¼ë¡œ ë®ì–´ì“°ê¸° ë©ë‹ˆë‹¤. ì‚¬ì´íŠ¸ ì½”ë“œë¥¼ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>

        <div class="section">
            <label>ğŸ–¼ï¸ ì´ë¯¸ì§€ ì„ íƒ</label>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <button onclick="uploadImage()" id="uploadBtn">ì„œë²„ì— ë°˜ì˜í•˜ê¸°</button>
        <div class="status" id="statusBox"></div>
    </div>

    <script>
        const USER = 'fun-let';
        const REPO = 'funlet';
        let currentMode = 'overwrite';

        // [í•µì‹¬] ìœ„ì¹˜ë³„ ê³ ì • íŒŒì¼ëª… ê·œì¹™ (ì—¬ê¸°ë§Œ ìˆ˜ì •í•˜ë©´ ë¨)
        const PRESETS = {
            'images/': [
                { name: 'ë©”ì¸ ìƒë‹¨ ë°°ë„ˆ (PC)', file: 'banner_main_pc.png' },
                { name: 'ì‚¬ì´ë“œë°” ë°°ë„ˆ', file: 'banner_sidebar.png' },
                { name: 'ê²Œì„ ê³µí†µ í•˜ë‹¨ ë°°ë„ˆ', file: 'banner_game_bottom.png' }
            ],
            'images/thumbnails/': [
                { name: 'ë¨¸ë‹ˆ íƒ€ì´ì¿¤ ì¸ë„¤ì¼', file: 'money_tycoon_thumb.jpg' },
                { name: 'í« ê°€ì±  ì¸ë„¤ì¼', file: 'pet_gacha_thumb.jpg' },
                { name: 'ìŠ¤ì¹´ì´ ì í”„ ì¸ë„¤ì¼', file: 'sky_thumb.jpg' }
            ]
        };

        window.onload = () => {
            const savedToken = localStorage.getItem('github_token');
            if(savedToken) document.getElementById('token').value = savedToken;
            loadFolders();
        }

        function saveToken() {
            localStorage.setItem('github_token', document.getElementById('token').value);
        }

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            if(mode === 'new') {
                document.getElementById('overwriteSection').style.display = 'none';
                document.getElementById('uploadBtn').innerText = "ìƒˆ íŒŒì¼ ì—…ë¡œë“œ";
            } else {
                document.getElementById('overwriteSection').style.display = 'block';
                document.getElementById('uploadBtn').innerText = "ì„œë²„ì— ë°˜ì˜í•˜ê¸° (ë®ì–´ì“°ê¸°)";
            }
        }

        // [ê¸°ëŠ¥ 1] GitHubì—ì„œ í´ë” ëª©ë¡ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
        async function loadFolders() {
            const token = document.getElementById('token').value;
            if(!token) return;

            const select = document.getElementById('folderList');
            select.innerHTML = '<option>ë¡œë”© ì¤‘...</option>';

            try {
                // images í´ë” ê²€ìƒ‰
                const url = `https://api.github.com/repos/${USER}/${REPO}/contents/images`;
                const response = await fetch(url, { headers: { Authorization: `token ${token}` } });
                const data = await response.json();

                select.innerHTML = '<option value="images/">images/ (ê¸°ë³¸ ë°°ë„ˆ)</option>';
                
                // í•˜ìœ„ í´ë”ë“¤ ì¶”ê°€
                data.forEach(item => {
                    if(item.type === 'dir') {
                        select.innerHTML += `<option value="images/${item.name}/">images/${item.name}/</option>`;
                    }
                });
                updatePresets();

            } catch (e) {
                select.innerHTML = '<option value="images/">images/ (ê¸°ë³¸)</option>';
                alert("í´ë” ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. í† í°ì„ í™•ì¸í•˜ì„¸ìš”.");
            }
        }

        // í´ë” ì„ íƒ ì‹œ í”„ë¦¬ì…‹ ì—…ë°ì´íŠ¸
        function updatePresets() {
            const folder = document.getElementById('folderList').value;
            const presetSelect = document.getElementById('filePreset');
            const targetInput = document.getElementById('targetFileName');
            
            presetSelect.innerHTML = '<option value="">-- ì§ì ‘ ì…ë ¥ --</option>';
            targetInput.value = "";

            if(PRESETS[folder]) {
                PRESETS[folder].forEach(p => {
                    presetSelect.innerHTML += `<option value="${p.file}">${p.name}</option>`;
                });
            }
        }

        function applyPreset() {
            document.getElementById('targetFileName').value = document.getElementById('filePreset').value;
        }

        // ì—…ë¡œë“œ ë¡œì§
        async function uploadImage() {
            const token = document.getElementById('token').value;
            const folder = document.getElementById('folderList').value;
            const file = document.getElementById('fileInput').files[0];
            let fileName = "";

            if(currentMode === 'overwrite') {
                fileName = document.getElementById('targetFileName').value;
            } else {
                fileName = file.name; // ì‹ ê·œ ì—…ë¡œë“œëŠ” íŒŒì¼ëª… ê·¸ëŒ€ë¡œ
            }

            if (!token || !file || !fileName) {
                alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            const btn = document.getElementById('uploadBtn');
            const statusBox = document.getElementById('statusBox');
            btn.disabled = true;
            statusBox.style.display = 'block';
            statusBox.innerText = "ì—…ë¡œë“œ ë° ê°±ì‹  ì¤‘...";

            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async function() {
                const content = reader.result.split(',')[1];
                const url = `https://api.github.com/repos/${USER}/${REPO}/contents/${folder}${fileName}`;
                
                // ê¸°ì¡´ íŒŒì¼ SHA ê°€ì ¸ì˜¤ê¸° (ë®ì–´ì“°ê¸° ìœ„í•´ í•„ìˆ˜)
                let sha = null;
                try {
                    const check = await fetch(url, { headers: { Authorization: `token ${token}` } });
                    if(check.ok) {
                        const data = await check.json();
                        sha = data.sha;
                    }
                } catch(e) {}

                const bodyData = {
                    message: `Update ${fileName} via Admin`,
                    content: content
                };
                if(sha) bodyData.sha = sha;

                try {
                    const response = await fetch(url, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(bodyData)
                    });

                    if (response.ok) {
                        statusBox.innerHTML = `âœ… <b>ì„±ê³µ!</b><br>1~2ë¶„ ë’¤ì— ì‚¬ì´íŠ¸ê°€ ê°±ì‹ ë©ë‹ˆë‹¤.<br>íŒŒì¼ëª…: ${folder}${fileName}`;
                        alert("ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤! ì ì‹œ í›„ ì‚¬ì´íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
                    } else {
                        const err = await response.json();
                        statusBox.innerText = "ì‹¤íŒ¨: " + err.message;
                    }
                } catch (error) {
                    statusBox.innerText = "ì˜¤ë¥˜: " + error;
                }
                btn.disabled = false;
            };
        }
    </script>
</body>
</html>
