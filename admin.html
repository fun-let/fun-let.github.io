<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUNLET ê´€ë¦¬ì í˜ì´ì§€</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background: #111; color: white; font-family: 'Noto Sans KR'; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { width: 400px; background: #222; padding: 30px; border-radius: 20px; box-shadow: 0 0 20px rgba(0,255,157,0.2); border: 1px solid #333; }
        h2 { text-align: center; color: #00ff9d; margin-bottom: 30px; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #ccc; }
        input, select { width: 100%; padding: 12px; background: #333; border: 1px solid #444; color: white; border-radius: 8px; box-sizing: border-box; }
        
        button { width: 100%; padding: 15px; background: #00ff9d; color: black; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; margin-top: 10px; }
        button:hover { background: #00cc7d; }
        
        .status { margin-top: 20px; padding: 15px; background: #333; border-radius: 8px; font-size: 0.9rem; color: #aaa; word-break: break-all; display: none; }
        .preview { margin-top: 20px; text-align: center; }
        .preview img { max-width: 100%; border-radius: 10px; display: none; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ”§ FUNLET ê´€ë¦¬ì</h2>

        <div class="form-group">
            <label>1. ê´€ë¦¬ì í† í° (Key)</label>
            <input type="password" id="token" placeholder="ghp_..." onchange="saveToken()">
        </div>

        <div class="form-group">
            <label>2. ì—…ë¡œë“œ ìœ„ì¹˜ ì„ íƒ</label>
            <select id="folder">
                <option value="images/thumbnails/">ê²Œì„ ì¸ë„¤ì¼ (images/thumbnails/)</option>
                <option value="images/pet-gacha/">í« ê°€ì±  ì´ë¯¸ì§€ (images/pet-gacha/)</option>
                <option value="images/sky-jump/">ìŠ¤ì¹´ì´ ì í”„ ì´ë¯¸ì§€ (images/sky-jump/)</option>
                <option value="images/">ê¸°íƒ€ ë°°ë„ˆ/ë°°ê²½ (images/)</option>
            </select>
        </div>

        <div class="form-group">
            <label>3. íŒŒì¼ ì„ íƒ</label>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <div class="form-group">
            <label>4. ì €ì¥ë  íŒŒì¼ëª… (ìë™ ì…ë ¥)</label>
            <input type="text" id="fileName" placeholder="ì˜ˆ: dog.png">
        </div>

        <div class="preview">
            <img id="previewImg" src="">
        </div>

        <button onclick="uploadImage()" id="uploadBtn">ì´ë¯¸ì§€ ì—…ë¡œë“œ í•˜ê¸°</button>
        
        <div class="status" id="statusBox">ëŒ€ê¸° ì¤‘...</div>
    </div>

    <script>
        // ì„¤ì •: ì‚¬ì¥ë‹˜ì˜ ì•„ì´ë””ì™€ ì €ì¥ì†Œ ì´ë¦„
        const USER = 'fun-let';
        const REPO = 'funlet';

        // í† í° ìë™ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° (ë§¤ë²ˆ ì…ë ¥ ì•ˆ í•´ë„ ë¨)
        window.onload = () => {
            const savedToken = localStorage.getItem('github_token');
            if(savedToken) document.getElementById('token').value = savedToken;
        }
        function saveToken() {
            localStorage.setItem('github_token', document.getElementById('token').value);
        }

        // íŒŒì¼ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸° & ì´ë¦„ ìë™ ì…ë ¥
        const fileInput = document.getElementById('fileInput');
        fileInput.addEventListener('change', function() {
            const file = this.files[0];
            if(file) {
                document.getElementById('fileName').value = file.name;
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('previewImg').style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });

        // ì—…ë¡œë“œ í•¨ìˆ˜
        async function uploadImage() {
            const token = document.getElementById('token').value;
            const folder = document.getElementById('folder').value;
            const file = fileInput.files[0];
            const fileName = document.getElementById('fileName').value;
            const statusBox = document.getElementById('statusBox');
            const btn = document.getElementById('uploadBtn');

            if (!token || !file || !fileName) {
                alert("í† í°ê³¼ íŒŒì¼ì„ ëª¨ë‘ í™•ì¸í•´ì£¼ì„¸ìš”.");
                return;
            }

            btn.disabled = true;
            btn.innerText = "ì—…ë¡œë“œ ì¤‘...";
            statusBox.style.display = 'block';
            statusBox.innerText = "GitHub ì°½ê³ ë¡œ ì „ì†¡ ì¤‘...";

            // íŒŒì¼ì„ Base64ë¡œ ë³€í™˜
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async function() {
                const content = reader.result.split(',')[1]; // Base64 ë°ì´í„°ë§Œ ì¶”ì¶œ

                const url = `https://api.github.com/repos/${USER}/${REPO}/contents/${folder}${fileName}`;
                
                // ê¸°ì¡´ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸ (ë®ì–´ì“°ê¸° ìœ„í•´ sha ê°’ í•„ìš”)
                let sha = null;
                try {
                    const check = await fetch(url, { headers: { Authorization: `token ${token}` } });
                    if(check.ok) {
                        const data = await check.json();
                        sha = data.sha;
                    }
                } catch(e) {}

                // ì—…ë¡œë“œ ìš”ì²­
                const bodyData = {
                    message: `Upload ${fileName} via Admin`,
                    content: content
                };
                if(sha) bodyData.sha = sha; // ë®ì–´ì“°ê¸°ì¸ ê²½ìš°

                try {
                    const response = await fetch(url, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(bodyData)
                    });

                    if (response.ok) {
                        const resData = await response.json();
                        const fileUrl = resData.content.download_url; // ì‹¤ì œ ì´ë¯¸ì§€ ì£¼ì†Œ
                        statusBox.innerHTML = `âœ… ì„±ê³µ!<br>ì£¼ì†Œ ë³µì‚¬í•´ì„œ ì“°ì„¸ìš”:<br><b style="color:#00ff9d; user-select:all;">./${folder}${fileName}</b>`;
                        alert("ì—…ë¡œë“œ ì„±ê³µ! ì•½ 1~2ë¶„ ë’¤ì— ì ìš©ë©ë‹ˆë‹¤.");
                    } else {
                        const err = await response.json();
                        statusBox.innerText = "âŒ ì‹¤íŒ¨: " + err.message;
                    }
                } catch (error) {
                    statusBox.innerText = "âŒ ì˜¤ë¥˜ ë°œìƒ: " + error;
                }
                
                btn.disabled = false;
                btn.innerText = "ì´ë¯¸ì§€ ì—…ë¡œë“œ í•˜ê¸°";
            };
        }
    </script>
</body>
</html>
