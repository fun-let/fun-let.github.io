<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FUNLET ìŠˆí¼ ê´€ë¦¬ì V6</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background: #111; color: white; font-family: 'Noto Sans KR'; padding: 20px; margin: 0; }
        .container { max-width: 900px; margin: 0 auto; background: #222; padding: 30px; border-radius: 20px; border: 1px solid #333; }
        h2 { text-align: center; color: #00ff9d; margin-bottom: 30px; }
        
        input, select, textarea { width: 100%; padding: 12px; background: #333; border: 1px solid #555; color: white; border-radius: 8px; box-sizing: border-box; margin-bottom: 15px; }
        textarea { height: 200px; font-family: monospace; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #ccc; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px; }
        .tab-btn { flex: 1; padding: 15px; background: transparent; border: none; color: #888; cursor: pointer; font-size: 1.1rem; font-weight: bold; }
        .tab-btn.active { color: #00ff9d; border-bottom: 3px solid #00ff9d; }
        
        .action-btn { width: 100%; padding: 15px; background: #00ff9d; color: black; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1.2rem; }
        .action-btn:hover { background: #00cc7d; }
        
        .status { margin-top: 20px; padding: 15px; background: #333; border-radius: 8px; color: #aaa; word-break: break-all; display: none; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ”§ FUNLET ìŠˆí¼ ê´€ë¦¬ì V6</h2>
        
        <input type="password" id="token" placeholder="ê´€ë¦¬ì í† í° (ghp_...)" onchange="saveToken()">

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('game')">ğŸ® ìƒˆ ê²Œì„ ë§Œë“¤ê¸°</button>
            <button class="tab-btn" onclick="switchTab('banner')">ğŸ–¼ï¸ ë°°ë„ˆ/ì´ë¯¸ì§€ ê´€ë¦¬</button>
        </div>

        <div id="tab-game">
            <label>1. ê²Œì„ ID (ì˜ì–´ ì†Œë¬¸ì, ë„ì–´ì“°ê¸° ê¸ˆì§€)</label>
            <input type="text" id="gameId" placeholder="ì˜ˆ: space-war">
            
            <label>2. ê²Œì„ ì œëª© (í•œê¸€ ê°€ëŠ¥)</label>
            <input type="text" id="gameTitle" placeholder="ì˜ˆ: ìš°ì£¼ ì „ìŸ">
            
            <label>3. ì¹´í…Œê³ ë¦¬</label>
            <select id="gameCategory">
                <option value="idle">í‚¤ìš°ê¸°/IDLE</option>
                <option value="simulation">ì‹œë®¬ë ˆì´ì…˜/ë½‘ê¸°</option>
                <option value="action">ì•¡ì…˜/ì•„ì¼€ì´ë“œ</option>
                <option value="social">ì†Œì…œ/ì‹¬ë¦¬</option>
            </select>
            
            <label>4. ì¸ë„¤ì¼ ì´ë¯¸ì§€</label>
            <input type="file" id="gameThumb" accept="image/*">
            
            <label>5. ê²Œì„ HTML ì½”ë“œ (ì „ì²´ ì½”ë“œ ë¶™ì—¬ë„£ê¸°)</label>
            <textarea id="gameCode" placeholder="<!DOCTYPE html>..."></textarea>
            
            <button class="action-btn" onclick="createGame()">ğŸš€ ê²Œì„ ìƒì„± ë° ê²Œì‹œí•˜ê¸°</button>
        </div>

        <div id="tab-banner" class="hidden">
            <p style="text-align:center; color:#888;">* ê¸°ì¡´ ì´ë¯¸ì§€ êµì²´ ë° ë§í¬ ê´€ë¦¬ëŠ” ì—¬ê¸°ì„œ í•˜ì„¸ìš”.</p>
            <button class="action-btn" style="background:#444; color:white;" onclick="alert('V5 ê´€ë¦¬ì í˜ì´ì§€ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”. ì§€ê¸ˆì€ ê²Œì„ ìƒì„±ì— ì§‘ì¤‘í•©ì‹œë‹¤!')">ê¸°ì¡´ ê´€ë¦¬ì ê¸°ëŠ¥ ë³´ê¸°</button>
        </div>

        <div id="statusBox" class="status"></div>
    </div>

    <script>
        const USER = 'fun-let';
        const REPO = 'funlet';

        window.onload = () => {
            const t = localStorage.getItem('github_token');
            if(t) document.getElementById('token').value = t;
        }
        function saveToken() { localStorage.setItem('github_token', document.getElementById('token').value); }
        function switchTab(t) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('tab-game').style.display = t === 'game' ? 'block' : 'none';
            document.getElementById('tab-banner').style.display = t === 'banner' ? 'block' : 'none';
        }

        // --- ê²Œì„ ìƒì„± í•µì‹¬ ë¡œì§ ---
        async function createGame() {
            const token = document.getElementById('token').value;
            const id = document.getElementById('gameId').value.trim();
            const title = document.getElementById('gameTitle').value;
            const category = document.getElementById('gameCategory').value;
            const code = document.getElementById('gameCode').value;
            const thumbFile = document.getElementById('gameThumb').files[0];
            const status = document.getElementById('statusBox');

            if (!token || !id || !title || !code || !thumbFile) {
                alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return;
            }

            status.style.display = 'block';
            status.innerHTML = "ì‘ì—… ì‹œì‘...<br>";

            try {
                // 1. ì¸ë„¤ì¼ ì—…ë¡œë“œ
                status.innerHTML += "1. ì¸ë„¤ì¼ ì—…ë¡œë“œ ì¤‘...<br>";
                const thumbContent = await readFileAsBase64(thumbFile);
                const thumbPath = `images/thumbnails/${id}_thumb.jpg`; // IDê¸°ë°˜ ìë™ ì‘ëª…
                await uploadFile(token, thumbPath, thumbContent, `Upload thumb for ${id}`);

                // 2. ê²Œì„ íŒŒì¼(index.html) ìƒì„±
                status.innerHTML += "2. ê²Œì„ íŒŒì¼ ìƒì„± ì¤‘...<br>";
                const codeContent = btoa(unescape(encodeURIComponent(code))); // í•œê¸€ ê¹¨ì§ ë°©ì§€ ì¸ì½”ë”©
                await uploadFile(token, `games/${id}/index.html`, codeContent, `Create game ${id}`);

                // 3. games.json ì—…ë°ì´íŠ¸ (ëª©ë¡ ì¶”ê°€)
                status.innerHTML += "3. ê²Œì„ ëª©ë¡ ê°±ì‹  ì¤‘...<br>";
                // 3-1. ê¸°ì¡´ JSON ê°€ì ¸ì˜¤ê¸°
                const jsonUrl = `https://api.github.com/repos/${USER}/${REPO}/contents/data/games.json`;
                const jsonRes = await fetch(jsonUrl, { headers: { Authorization: `token ${token}` } });
                const jsonData = await jsonRes.json();
                const currentGames = JSON.parse(new TextDecoder().decode(Uint8Array.from(atob(jsonData.content), c => c.charCodeAt(0))));
                
                // 3-2. ìƒˆ ê²Œì„ ì •ë³´ ì¶”ê°€
                const newGameEntry = {
                    id: id,
                    title: title,
                    category: category,
                    desc: category.toUpperCase() + " / ì‹ ê·œê²Œì„",
                    thumb: thumbPath
                };
                currentGames.push(newGameEntry);

                // 3-3. JSON ì €ì¥
                const newJsonContent = btoa(unescape(encodeURIComponent(JSON.stringify(currentGames, null, 2))));
                await uploadFile(token, 'data/games.json', newJsonContent, `Add game ${title}`, jsonData.sha);

                status.innerHTML += "<b style='color:#00ff9d'>ğŸ‰ ëª¨ë“  ì‘ì—… ì™„ë£Œ! 1ë¶„ ë’¤ í™•ì¸í•˜ì„¸ìš”.</b>";
                alert("ê²Œì„ ìƒì„± ì„±ê³µ!");

            } catch (e) {
                status.innerHTML += `<b style='color:red'>ì‹¤íŒ¨: ${e.message}</b>`;
            }
        }

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        async function uploadFile(token, path, content, msg, sha = null) {
            const body = { message: msg, content: content };
            if (sha) body.sha = sha;

            const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${path}`, {
                method: 'PUT',
                headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
            if (!res.ok) throw new Error(await res.text());
        }
    </script>
</body>
</html>
