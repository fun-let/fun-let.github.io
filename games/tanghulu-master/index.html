<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>íƒ•í›„ë£¨ ë§ˆìŠ¤í„° V2</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --bg: #FFF0F5; --primary: #FF6B6B; }
        body { margin: 0; background: var(--bg); font-family: 'Jua', sans-serif; overflow: hidden; user-select: none; display:flex; justify-content:center; height: 100vh; height: 100dvh; }
        
        #gameContainer {
            width: 100%; max-width: 500px; height: 100%; background: white;
            display: flex; flex-direction: column; position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* ìƒë‹¨ ì •ë³´ */
        .header { padding: 15px; background: white; border-bottom: 2px solid #ffccd5; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .money-box { font-size: 1.5rem; color: #555; }
        .money-val { color: var(--primary); font-size: 1.8rem; margin-left: 5px; }

        /* ë©”ì¸ ìŠ¤í…Œì´ì§€ (ì†ë‹˜ & ì¡°ë¦¬ëŒ€) */
        .stage { flex: 1; position: relative; background-image: radial-gradient(#fff 20%, #ffe6eb 20%); background-size: 20px 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* ì†ë‹˜ */
        .customer-area { position: relative; width: 200px; height: 250px; display: flex; justify-content: center; align-items: flex-end; }
        .customer-img { width: 120px; transition: 0.3s; }
        .bubble { 
            position: absolute; top: 0; right: -20px; background: white; border: 3px solid #333; 
            padding: 10px; border-radius: 20px; font-size: 1.2rem; min-width: 80px; text-align: center;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.1); animation: bounceIn 0.5s;
        }
        .bubble img { width: 40px; vertical-align: middle; }

        /* ë‚´ ê¼¬ì¹˜ (ë§Œë“œëŠ” ì¤‘) */
        .my-stick { 
            margin-top: 20px; width: 10px; height: 150px; background: #d2b48c; border-radius: 5px; 
            position: relative; display: flex; flex-direction: column-reverse; align-items: center; justify-content: flex-start;
            border: 2px solid #8b4513;
        }
        .fruit-on-stick { width: 50px; height: 50px; object-fit: contain; margin-bottom: -10px; z-index: 5; animation: rubberBand 0.5s; }

        /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ (ê³¼ì¼ ë²„íŠ¼ë“¤) */
        .controls { 
            background: white; padding: 15px; border-top: 2px solid #ffccd5; 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
            height: 220px; overflow-y: auto;
        }
        
        .fruit-btn {
            background: #fff; border: 2px solid #eee; border-radius: 15px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; padding: 10px; transition: 0.1s; position: relative;
        }
        .fruit-btn:active { transform: scale(0.95); background: #f9f9f9; }
        .fruit-btn img { width: 50px; height: 50px; object-fit: contain; margin-bottom: 5px; }
        .fruit-name { font-size: 0.9rem; color: #555; }
        .lock-mask { 
            position: absolute; top:0; left:0; width:100%; height:100%; 
            background: rgba(0,0,0,0.6); border-radius: 13px; color: white;
            display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem;
        }

        /* í•˜ë‹¨ ë°°ë„ˆ */
        .ad-banner-area { height: 100px; background: #f0f0f0; border-top: 1px solid #ddd; flex-shrink: 0; display:flex; justify-content:center; align-items:center; }

        /* í”¼ë“œë°± íš¨ê³¼ */
        .feedback { position: absolute; font-size: 3rem; font-weight: bold; pointer-events: none; z-index: 100; animation: fadeOutUp 1s forwards; }
        .success { color: #00ff9d; text-shadow: 2px 2px 0 #000; }
        .fail { color: #ff4757; text-shadow: 2px 2px 0 #000; }
        @keyframes fadeOutUp { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-50px); } }
    </style>
</head>
<body>

    <div id="gameContainer">
        <div class="header">
            <div class="money-box">ğŸ’° <span class="money-val" id="money">0</span></div>
            <button onclick="resetGame()" style="background:none; border:none; color:#aaa; cursor:pointer;">ğŸ”„ ì´ˆê¸°í™”</button>
        </div>

        <div class="stage">
            <div class="customer-area">
                <div class="bubble" id="orderBubble">...</div>
                <img src="../../images/tanghulu/customer.png" class="customer-img" id="customerImg" onerror="this.src='../../images/tanghulu/chef.png'">
            </div>
            
            <div class="my-stick" id="myStick">
                </div>
            <div style="margin-top:10px; color:#888; font-size:0.9rem;">ì£¼ë¬¸ì— ë§ì¶° ê³¼ì¼ì„ ëˆ„ë¥´ì„¸ìš”!</div>
        </div>

        <div class="controls" id="fruitGrid">
            </div>

        <div class="ad-banner-area" id="ad-game-bottom"></div>
    </div>

    <audio id="sfx-correct" src="../../audio/coin.mp3"></audio>
    <audio id="sfx-wrong" src="../../audio/wrong.mp3"></audio> <script src="../../js/ads.js"></script>

    <script>
        // ê³¼ì¼ ë°ì´í„° (ì´ë¯¸ì§€ íŒŒì¼ëª…ê³¼ ë§¤ì¹­ ì¤‘ìš”!)
        const FRUITS = [
            { id: 0, name: "ë”¸ê¸°", price: 100, unlock: 0, img: "fruit_0.png" },
            { id: 1, name: "ê·¤", price: 300, unlock: 1000, img: "fruit_1.png" },
            { id: 2, name: "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“", price: 800, unlock: 3000, img: "fruit_2.png" },
            { id: 3, name: "íŒŒì¸ì• í”Œ", price: 1500, unlock: 8000, img: "fruit_3.png" },
            { id: 4, name: "ë¸”ë™ì‚¬íŒŒì´ì–´", price: 3000, unlock: 20000, img: "fruit_4.png" },
            { id: 5, name: "ì˜¤ë§ˆì¹´ì„¸", price: 10000, unlock: 50000, img: "fruit_5.png" }
        ];

        let game = {
            money: 0,
            unlockedMax: 0 // í•´ê¸ˆëœ ìµœê³  ë ˆë²¨
        };

        let currentOrder = 0; // í˜„ì¬ ì†ë‹˜ì´ ì›í•˜ëŠ” ê³¼ì¼ ID
        let stickFruits = []; // í˜„ì¬ ê¼¬ì¹˜ì— ê½‚ì€ ê³¼ì¼ë“¤ (ì§€ê¸ˆì€ 1ê°œë§Œ ê½‚ìœ¼ë©´ ì„±ê³µí•˜ê²Œ ë‹¨ìˆœí™”)

        // ì´ˆê¸°í™”
        const saved = localStorage.getItem('tanghuluV2');
        if(saved) game = JSON.parse(saved);
        
        renderFruits();
        updateMoney();
        newCustomer();

        function renderFruits() {
            const grid = document.getElementById('fruitGrid');
            grid.innerHTML = "";
            
            FRUITS.forEach((f, idx) => {
                const btn = document.createElement('div');
                btn.className = 'fruit-btn';
                
                // ì´ë¯¸ì§€ ê²½ë¡œ ì£¼ì˜ (../../images/tanghulu/...)
                let html = `<img src="../../images/tanghulu/${f.img}" onerror="this.src='https://via.placeholder.com/50?text=?'">
                            <div class="fruit-name">${f.name}</div>`;
                
                // ì ê¸ˆ ì²˜ë¦¬
                if (idx > game.unlockedMax) {
                    html += `<div class="lock-mask" onclick="unlockFruit(${idx}, ${f.unlock}, event)">
                                <i class="fa-solid fa-lock"></i>
                                <div>${f.unlock.toLocaleString()}ì›</div>
                             </div>`;
                } else {
                    btn.onclick = () => addToStick(idx);
                }
                
                btn.innerHTML = html;
                grid.appendChild(btn);
            });
        }

        function unlockFruit(idx, cost, e) {
            e.stopPropagation(); // ë²„íŠ¼ í´ë¦­ ë°©ì§€
            if(game.money >= cost) {
                game.money -= cost;
                game.unlockedMax = idx;
                updateMoney();
                renderFruits();
                // íŒ¡íŒŒë ˆ íš¨ê³¼ìŒ ì¬ìƒ ê°€ëŠ¥
            } else {
                alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤! ë” ì—´ì‹¬íˆ íŒŒì„¸ìš”!");
            }
        }

        function newCustomer() {
            // í•´ê¸ˆëœ ê³¼ì¼ ì¤‘ì—ì„œ ëœë¤ ì£¼ë¬¸
            currentOrder = Math.floor(Math.random() * (game.unlockedMax + 1));
            
            // ë§í’ì„  ì—…ë°ì´íŠ¸
            const targetFruit = FRUITS[currentOrder];
            document.getElementById('orderBubble').innerHTML = `
                <img src="../../images/tanghulu/${targetFruit.img}" style="width:30px;"> ì£¼ì„¸ìš”!
            `;
            
            // ê¼¬ì¹˜ ì´ˆê¸°í™”
            document.getElementById('myStick').innerHTML = "";
            stickFruits = [];
        }

        function addToStick(fruitId) {
            // ê¼¬ì¹˜ì— ê³¼ì¼ ì¶”ê°€ ì‹œê°íš¨ê³¼
            const stick = document.getElementById('myStick');
            const img = document.createElement('img');
            img.src = `../../images/tanghulu/${FRUITS[fruitId].img}`;
            img.className = 'fruit-on-stick';
            stick.appendChild(img);

            // ì •ë‹µ í™•ì¸ (ì§€ê¸ˆì€ 1ê°œë§Œ ê½‚ìœ¼ë©´ ë°”ë¡œ íŒì •)
            if (fruitId === currentOrder) {
                // ì„±ê³µ!
                const reward = FRUITS[fruitId].price;
                game.money += reward;
                showFeedback("ë§›ìˆë‹¤!", true);
                try { document.getElementById('sfx-correct').play(); } catch(e){}
            } else {
                // ì‹¤íŒ¨
                showFeedback("ìš°ì›©!", false);
                // try { document.getElementById('sfx-wrong').play(); } catch(e){}
            }
            
            updateMoney();
            saveGame();
            
            // 0.5ì´ˆ ë’¤ ë‹¤ìŒ ì†ë‹˜
            setTimeout(() => {
                newCustomer();
            }, 500);
        }

        function showFeedback(text, isSuccess) {
            const el = document.createElement('div');
            el.className = `feedback ${isSuccess ? 'success' : 'fail'}`;
            el.innerText = text;
            el.style.left = '50%';
            el.style.top = '30%';
            el.style.transform = 'translateX(-50%)';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function updateMoney() {
            document.getElementById('money').innerText = game.money.toLocaleString();
        }

        function saveGame() {
            localStorage.setItem('tanghuluV2', JSON.stringify(game));
        }
        
        function resetGame() {
            if(confirm("ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”?")) {
                localStorage.removeItem('tanghuluV2');
                location.reload();
            }
        }
    </script>
</body>
</html>