<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>íƒ•í›„ë£¨ ë§ˆìŠ¤í„°</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --bg: #FFD1DC; --panel: #FFF0F5; --primary: #FF6B6B; }
        body { margin: 0; background: var(--bg); font-family: 'Jua', sans-serif; overflow: hidden; user-select: none; display:flex; justify-content:center; height: 100vh; height: 100dvh; }
        
        #gameContainer {
            width: 100%; max-width: 500px; height: 100%; background: white;
            display: flex; flex-direction: column; position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* ìƒë‹¨ ì •ë³´ */
        .header { padding: 20px; background: var(--panel); border-bottom: 2px solid #ffb7b2; display: flex; justify-content: space-between; align-items: center; }
        .money-box { font-size: 1.5rem; color: #555; display: flex; align-items: center; gap: 5px; }
        .money-val { color: var(--primary); font-size: 1.8rem; }

        /* ë©”ì¸ ì¡°ë¦¬ëŒ€ */
        .kitchen { flex: 1; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        .chef { width: 150px; margin-bottom: 20px; cursor: pointer; transition: 0.1s; z-index: 10; }
        .chef:active { transform: scale(0.95); }
        .table { width: 80%; height: 10px; background: #ddd; border-radius: 50%; margin-top: -10px; z-index: 5; }
        
        /* íƒ•í›„ë£¨ ì• ë‹ˆë©”ì´ì…˜ */
        .tanghulu { position: absolute; font-size: 2rem; animation: floatUp 1s forwards; pointer-events: none; z-index: 20; }
        @keyframes floatUp { 0% { transform: translateY(0) scale(0.5); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(-100px) scale(1.2); opacity: 0; } }

        /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel { background: var(--panel); padding: 15px; border-top: 2px solid #ffb7b2; height: 280px; display: flex; flex-direction: column; }
        .buff-area { display: flex; gap: 10px; margin-bottom: 10px; }
        .buff-btn { 
            flex: 1; padding: 10px; border: none; border-radius: 10px; color: white; font-family: 'Jua'; cursor: pointer; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; font-size: 0.9rem;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2); transition: 0.1s;
        }
        .buff-btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-speed { background: #FF9F1C; }
        .btn-gold { background: #4ECDC4; }

        /* ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ */
        .menu-list { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .menu-item { 
            background: white; padding: 10px; border-radius: 15px; border: 2px solid #eee; 
            display: flex; align-items: center; cursor: pointer; transition: 0.2s;
        }
        .menu-item:hover { border-color: var(--primary); }
        .menu-icon { width: 50px; height: 50px; background: #f0f0f0; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-right: 15px; }
        .menu-info { flex: 1; }
        .menu-name { font-size: 1.1rem; margin-bottom: 3px; }
        .menu-price { color: #888; font-size: 0.9rem; }
        .menu-level { background: #333; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; }

        /* í•˜ë‹¨ ë°°ë„ˆ (í•„ìˆ˜) */
        .ad-banner-area { height: 100px; background: #f8f8f8; border-top: 1px solid #ddd; flex-shrink: 0; display: flex; justify-content: center; align-items: center; }
        
        /* íŒì—… ë©”ì‹œì§€ */
        .toast { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.8); color: white; padding: 15px 30px; border-radius: 20px; display: none; z-index: 100; text-align: center; }
    </style>
</head>
<body>

    <div id="gameContainer">
        <div class="header">
            <div class="money-box">
                <i class="fa-solid fa-won-sign" style="color:#FFD700;"></i>
                <span class="money-val" id="money">0</span>
            </div>
            <div style="font-size:0.9rem; color:#888;">ì´ˆë‹¹ ìˆ˜ìµ: <span id="cps">0</span>ì›</div>
        </div>

        <div class="kitchen" onclick="clickChef(event)">
            <img src="../../images/tanghulu/chef.png" class="chef" id="chefImg" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
            <div style="font-size:5rem; display:none; cursor:pointer;">ğŸ‘©â€ğŸ³</div>
            <div class="table"></div>
            <div style="position:absolute; bottom: 80px; color:#aaa; font-size:0.9rem;">í™”ë©´ì„ íƒ­í•´ì„œ íƒ•í›„ë£¨ë¥¼ ë§Œë“œì„¸ìš”!</div>
        </div>

        <div class="control-panel">
            <div class="buff-area">
                <button class="buff-btn btn-speed" onclick="watchAd('speed')">
                    <i class="fa-solid fa-bolt"></i> <span>2ë°° ì†ë„ (1ë¶„)</span>
                    <small>ğŸ“º ê´‘ê³ ë³´ê¸°</small>
                </button>
                <button class="buff-btn btn-gold" onclick="watchAd('gold')">
                    <i class="fa-solid fa-sack-dollar"></i> <span>ì§€ì›ê¸ˆ ë°›ê¸°</span>
                    <small>ğŸ“º ê´‘ê³ ë³´ê¸°</small>
                </button>
            </div>

            <div class="menu-list" id="menuList">
                </div>
        </div>

        <div class="ad-banner-area" id="ad-game-bottom"></div>
    </div>

    <div class="toast" id="toast">ë²„í”„ ë°œë™! íŒë§¤ ì†ë„ê°€ ë¹¨ë¼ì§‘ë‹ˆë‹¤! ğŸ”¥</div>

    <script src="../../js/ads.js"></script>
    <script>
        // ê²Œì„ ë°ì´í„°
        const FRUITS = [
            { name: "ë”¸ê¸° íƒ•í›„ë£¨", base: 100, cps: 5, icon: "ğŸ“" },
            { name: "ê·¤ íƒ•í›„ë£¨", base: 500, cps: 20, icon: "ğŸŠ" },
            { name: "ìƒ¤ì¸ë¨¸ìŠ¤ì¼“", base: 2000, cps: 80, icon: "ğŸ‡" },
            { name: "ë¸”ë™ ì‚¬íŒŒì´ì–´", base: 8000, cps: 250, icon: "ğŸ†" },
            { name: "íŒŒì¸ì• í”Œ", base: 30000, cps: 800, icon: "ğŸ" },
            { name: "ì˜¤ë§ˆì¹´ì„¸ ê¼¬ì¹˜", base: 100000, cps: 3000, icon: "ğŸ¢" }
        ];

        let game = {
            money: 0,
            levels: [1, 0, 0, 0, 0, 0], // ê° ê³¼ì¼ ë ˆë²¨ (0ì´ë©´ ë¯¸í•´ê¸ˆ)
            multiplier: 1 // ë²„í”„ ë°°ìœ¨
        };

        // ì´ˆê¸°í™”
        const saved = localStorage.getItem('tanghuluSave');
        if(saved) game = JSON.parse(saved);
        
        // UI ê°±ì‹  ë£¨í”„
        setInterval(() => {
            let cps = 0;
            game.levels.forEach((lv, i) => {
                if(lv > 0) cps += (FRUITS[i].cps * lv);
            });
            
            // ëˆ ì¦ê°€ (ë²„í”„ ì ìš©)
            game.money += (cps * game.multiplier) / 10;
            
            updateUI(cps * game.multiplier);
            localStorage.setItem('tanghuluSave', JSON.stringify(game));
        }, 100);

        function updateUI(cps) {
            document.getElementById('money').innerText = Math.floor(game.money).toLocaleString();
            document.getElementById('cps').innerText = Math.floor(cps).toLocaleString();
            renderMenu();
        }

        // ë©”ë‰´ ê·¸ë¦¬ê¸°
        function renderMenu() {
            const list = document.getElementById('menuList');
            list.innerHTML = "";
            
            FRUITS.forEach((fruit, i) => {
                const lv = game.levels[i];
                const cost = Math.floor(fruit.base * Math.pow(1.5, lv));
                const isLocked = (i > 0 && game.levels[i-1] === 0); // ì´ì „ ë‹¨ê³„ ì•ˆ ìƒ€ìœ¼ë©´ ì ê¹€
                
                if(!isLocked || lv > 0) { // ì ê¸°ì§€ ì•Šì•˜ê±°ë‚˜ ì´ë¯¸ ìƒ€ìœ¼ë©´ ë³´ì—¬ì¤Œ
                    const div = document.createElement('div');
                    div.className = 'menu-item';
                    div.style.opacity = (game.money >= cost) ? '1' : '0.6';
                    div.onclick = () => buyUpgrade(i, cost);
                    div.innerHTML = `
                        <div class="menu-icon">${fruit.icon}</div>
                        <div class="menu-info">
                            <div class="menu-name">${fruit.name} <span class="menu-level">Lv.${lv}</span></div>
                            <div class="menu-price">ë¹„ìš©: ${cost.toLocaleString()}ì›</div>
                        </div>
                        <div style="color:${game.money >= cost ? '#4ECDC4' : '#aaa'}">
                            <i class="fa-solid fa-arrow-up"></i>
                        </div>
                    `;
                    list.appendChild(div);
                }
            });
        }

        function buyUpgrade(idx, cost) {
            if(game.money >= cost) {
                game.money -= cost;
                game.levels[idx]++;
                // í´ë¦­ íš¨ê³¼
                createFloatText(`Lv UP!`, window.innerWidth/2, window.innerHeight/2);
                updateUI(0); // ì¦‰ì‹œ ê°±ì‹ 
            }
        }

        function clickChef(e) {
            // í´ë¦­ ì‹œ ëˆ ë²Œê¸° (ê¸°ë³¸ 10ì› + ë ˆë²¨ ë¹„ë¡€)
            let clickVal = 10;
            game.levels.forEach((lv, i) => clickVal += (lv * (i+1) * 2));
            
            game.money += clickVal;
            createFloatText(`+${clickVal}`, e.clientX, e.clientY);
            
            // íƒ•í›„ë£¨ ì•„ì´ì½˜ íŠ€ì–´ì˜¤ë¥´ê¸°
            const fruit = document.createElement('div');
            fruit.className = 'tanghulu';
            fruit.innerText = FRUITS[Math.min(game.levels.filter(l=>l>0).length-1, FRUITS.length-1)].icon;
            fruit.style.left = (e.clientX - 20) + 'px';
            fruit.style.top = (e.clientY - 50) + 'px';
            document.body.appendChild(fruit);
            setTimeout(() => fruit.remove(), 1000);
        }

        function createFloatText(text, x, y) {
            const el = document.createElement('div');
            el.innerText = text;
            el.style.cssText = `position:absolute; left:${x}px; top:${y}px; color:#FF6B6B; font-weight:bold; font-size:1.5rem; pointer-events:none; animation: floatUp 0.8s forwards; z-index:100;`;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        // [í•µì‹¬] ë³´ìƒí˜• ê´‘ê³  ë¡œì§
        function watchAd(type) {
            if(window.showRewardAd) {
                window.showRewardAd(() => {
                    // ê´‘ê³  ì‹œì²­ ì™„ë£Œ í›„ ë³´ìƒ ì§€ê¸‰
                    if(type === 'speed') {
                        activateSpeedBuff();
                    } else if(type === 'gold') {
                        giveGoldReward();
                    }
                });
            } else {
                alert("ê´‘ê³  ì‹œìŠ¤í…œ ë¡œë”© ì¤‘...");
            }
        }

        function activateSpeedBuff() {
            game.multiplier = 2; // 2ë°° ì†ë„
            showToast("ğŸ”¥ ë¶€ìŠ¤íŠ¸ ë°œë™! (1ë¶„ê°„ ìˆ˜ìµ 2ë°°)");
            setTimeout(() => {
                game.multiplier = 1;
                showToast("ë¶€ìŠ¤íŠ¸ ì¢…ë£Œ");
            }, 60000); // 1ë¶„ ë’¤ ì›ìƒë³µêµ¬
        }

        function giveGoldReward() {
            let reward = 10000 + (game.levels.reduce((a,b)=>a+b, 0) * 1000); // ì„±ì¥ ë¹„ë¡€ ë³´ìƒ
            game.money += reward;
            showToast(`ğŸ’° ì§€ì›ê¸ˆ ${reward.toLocaleString()}ì› ë„ì°©!`);
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            t.classList.add('animate__animated', 'animate__fadeInUp');
            setTimeout(() => t.style.display = 'none', 3000);
        }
    </script>
</body>
</html>