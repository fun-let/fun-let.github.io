<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Money Tycoon V3</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        :root { --primary: #ffd700; --bg: #111; --panel: rgba(0,0,0,0.8); }
        body { margin:0; background-color:var(--bg); color:white; font-family:'Noto Sans KR'; overflow:hidden; user-select:none; }
        
        /* ì „ì²´ ì»¨í…Œì´ë„ˆ (ë°°ê²½ ì´ë¯¸ì§€ ì ìš© ì˜ˆì •) */
        .game-container {
            display:flex; height:100vh;
            background-size: cover;
            background-position: center;
            background-image: url('../../images/bg_main.png'); /* ë°°ê²½ ì´ë¯¸ì§€ */
            transition: background 0.5s;
        }

        /* ì™¼ìª½: í”Œë ˆì´ ì˜ì—­ */
        .play-area { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; }
        
        /* ìƒë‹¨ ì •ë³´ì°½ */
        .stats-box { 
            text-align:center; z-index:10; 
            background: rgba(0,0,0,0.6); padding: 15px 30px; border-radius: 20px;
            backdrop-filter: blur(5px); border: 2px solid rgba(255,255,255,0.1);
        }
        .level-badge { background: #ff4757; padding: 5px 10px; border-radius: 10px; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; display: inline-block;}
        .money { font-family:'Black Han Sans'; font-size:2.8rem; color:var(--primary); text-shadow:0 0 20px rgba(255, 215, 0, 0.6); }
        .cps { color:#ddd; font-size:0.9rem; margin-top: 5px; }

        /* ìºë¦­í„° ë²„íŠ¼ (í´ë¦­ íƒ€ê²Ÿ) */
        .character-btn {
            width: 300px; height: 300px; margin: 30px 0;
            cursor: pointer; position: relative; z-index: 5;
            transition: transform 0.1s;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
        }
        .character-btn:active { transform: scale(0.95) rotate(-2deg); }
        .character-btn img { width: 100%; height: 100%; object-fit: contain; }

        /* ê´‘ê³  ë°°ë„ˆ (ì ì„  ì œê±° ì™„ë£Œ!) */
        .ad-banner-area {
            position: absolute; bottom: 20px;
            width: 320px; height: 100px;
            background: transparent; /* ë°°ê²½ íˆ¬ëª… */
            border: none; /* ì ì„  í…Œë‘ë¦¬ ì œê±° */
            display: flex; align-items: center; justify-content: center;
            z-index: 20;
        }

        /* ì˜¤ë¥¸ìª½: ìƒì  */
        .shop-area { width: 380px; background: var(--panel); border-left: 1px solid #444; display: flex; flex-direction: column; backdrop-filter: blur(10px); }
        .shop-header { padding: 20px; font-family: 'Black Han Sans'; text-align: center; background: rgba(255,255,255,0.05); font-size: 1.3rem; border-bottom: 1px solid #444; }
        .shop-list { flex: 1; overflow-y: auto; padding: 15px; }

        /* ì•„ì´í…œ */
        .item { display: flex; align-items: center; background: rgba(255,255,255,0.05); padding: 12px; margin-bottom: 10px; border-radius: 12px; cursor: pointer; border: 1px solid transparent; transition: 0.2s; }
        .item:hover { background: rgba(255,255,255,0.1); transform: translateX(-5px); }
        .item.can-buy { border-color: var(--primary); box-shadow: 0 0 10px rgba(255, 215, 0, 0.1); }
        .item-img { width: 45px; height: 45px; margin-right: 15px; border-radius: 8px; overflow: hidden; background: #000; }
        .item-img img { width:100%; height:100%; object-fit:cover; }
        .item-info { flex: 1; }
        .item-name { font-weight: bold; font-size: 1rem; color: #fff; }
        .item-cost { color: var(--primary); font-weight: bold; }
        .item-count { background: #333; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; color: #aaa; }

        /* í´ë¦­ ì´í™íŠ¸ */
        .float-num { 
            position: absolute; color: white; font-weight: 900; 
            font-size: 1.5rem; pointer-events: none; 
            text-shadow: 0 0 5px black;
            animation: floatUp 0.8s forwards; 
            z-index: 100;
        }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-80px) scale(1.5); opacity: 0; } }

        /* ì‹œì‘ ì˜¤ë²„ë ˆì´ (ìŒì•… ì¬ìƒìš©) */
        #start-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .start-btn {
            padding: 20px 50px; font-size: 2rem; font-family: 'Black Han Sans';
            background: var(--primary); color: black; border: none; border-radius: 50px;
            cursor: pointer; animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        @media (max-width: 768px) { .game-container { flex-direction: column; } .shop-area { width: 100%; height: 50%; } .character-btn { width: 200px; height: 200px; margin: 10px 0; } }
    </style>
</head>
<body>

    <audio id="bgm" src="../../audio/bgm.mp3" loop></audio>
    <audio id="sfx-click" src="../../audio/click.mp3"></audio>
    <audio id="sfx-coin" src="../../audio/coin.mp3"></audio>

    <div id="start-overlay">
        <h1 style="color:white; margin-bottom:30px;">Money Tycoon V3</h1>
        <button class="start-btn" onclick="startGame()">ê²Œì„ ì‹œì‘í•˜ê¸°</button>
        <p style="color:#888; margin-top:20px;">ì†Œë¦¬ê°€ ì¼œì ¸ ìˆìŠµë‹ˆë‹¤ ğŸ”Š</p>
    </div>

    <div class="game-container" id="bgContainer">
        <div class="play-area">
            <div class="stats-box">
                <div class="level-badge" id="lvBadge">Lv.1 ê±°ì§€</div>
                <div class="money" id="moneyDisplay">0ì›</div>
                <div class="cps" id="cpsDisplay">ì´ˆë‹¹ 0ì›</div>
            </div>

            <div class="character-btn" id="clickTarget">
                <img id="charImg" src="../../images/char_lv1.png" alt="Character">
            </div>

            <div class="ad-banner-area" id="ad-game-bottom"></div>
        </div>

        <div class="shop-area">
            <div class="shop-header">ğŸ’ ë¶€ìë˜ëŠ” ìƒì </div>
            <div class="shop-list" id="shopList"></div>
        </div>
    </div>

    <script src="../../js/ads.js"></script>

    <script>
        // ê²Œì„ ë°ì´í„°
        let game = {
            money: 0,
            totalMoney: 0, // ëˆ„ì  ëˆ (ë ˆë²¨ì—…ìš©)
            level: 1,
            items: [
                { name: "êµ¬ê±¸í•˜ê¸°", cost: 15, val: 1, count: 0, img: "https://cdn-icons-png.flaticon.com/512/2953/2953363.png" },
                { name: "íì§€ ì¤ê¸°", cost: 100, val: 5, count: 0, img: "https://cdn-icons-png.flaticon.com/512/10697/10697629.png" },
                { name: "í¸ì˜ì  ì•Œë°”", cost: 500, val: 20, count: 0, img: "https://cdn-icons-png.flaticon.com/512/2250/2250379.png" },
                { name: "ì£¼ì‹ íˆ¬ì", cost: 2000, val: 100, count: 0, img: "https://cdn-icons-png.flaticon.com/512/3310/3310624.png" },
                { name: "ë¶€ë™ì‚° ë§¤ì…", cost: 10000, val: 500, count: 0, img: "https://cdn-icons-png.flaticon.com/512/609/609803.png" },
                { name: "ê¸°ì—… ì¸ìˆ˜", cost: 50000, val: 2500, count: 0, img: "https://cdn-icons-png.flaticon.com/512/1518/1518974.png" }
            ]
        };

        // UI ìš”ì†Œ
        const ui = {
            money: document.getElementById('moneyDisplay'),
            cps: document.getElementById('cpsDisplay'),
            shop: document.getElementById('shopList'),
            charImg: document.getElementById('charImg'),
            lvBadge: document.getElementById('lvBadge'),
            bg: document.getElementById('bgContainer')
        };

        // ì˜¤ë””ì˜¤ ìš”ì†Œ
        const audio = {
            bgm: document.getElementById('bgm'),
            click: document.getElementById('sfx-click'),
            coin: document.getElementById('sfx-coin')
        };

        // ê²Œì„ ì‹œì‘ í•¨ìˆ˜
        function startGame() {
            document.getElementById('start-overlay').style.display = 'none';
            audio.bgm.volume = 0.3; // ë°°ê²½ìŒ ë³¼ë¥¨ ì¡°ì ˆ
            audio.bgm.play().catch(e => console.log("Audio Error:", e));
            loadGame();
        }

        // íš¨ê³¼ìŒ ì¬ìƒ (ê²¹ì¹˜ê²Œ ì¬ìƒ ê°€ëŠ¥í•˜ë„ë¡)
        function playSound(sound) {
            sound.currentTime = 0;
            sound.play();
        }

        // ë ˆë²¨ ì‹œìŠ¤í…œ (ì´ë¯¸ì§€ êµì²´)
        function checkLevelUp() {
            let prevLevel = game.level;
            
            if(game.totalMoney < 1000) game.level = 1;
            else if(game.totalMoney < 10000) game.level = 2;
            else if(game.totalMoney < 100000) game.level = 3;
            else game.level = 4;

            if(game.level !== prevLevel || prevLevel === 1) {
                // ë ˆë²¨ë³„ ì´ë¯¸ì§€ ë° ì¹­í˜¸ ë³€ê²½
                const titles = ["ê±°ì§€", "ì‹œë¯¼", "ë¶€ì", "íšŒì¥ë‹˜"];
                ui.lvBadge.innerText = `Lv.${game.level} ${titles[game.level-1]}`;
                ui.charImg.src = `../../images/char_lv${game.level}.png`; // ì‚¬ì¥ë‹˜ ì´ë¯¸ì§€ ì ìš©
                
                // ë§Œì•½ ì´ë¯¸ì§€ë¥¼ ì•„ì§ ì•ˆ ì˜¬ë ¸ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ê¸°ë³¸ ì´ë¯¸ì§€ (ì—ëŸ¬ ë°©ì§€ìš©)
                ui.charImg.onerror = function() {
                    const fallback = ["616408", "4712109", "2504789", "1518974"];
                    this.src = `https://cdn-icons-png.flaticon.com/512/616/${fallback[game.level-1]}.png`;
                };
            }
        }

        function updateUI() {
            ui.money.innerText = Math.floor(game.money).toLocaleString() + "ì›";
            let mps = game.items.reduce((acc, item) => acc + (item.val * item.count), 0);
            ui.cps.innerText = "ì´ˆë‹¹ " + mps.toLocaleString() + "ì›";
            checkLevelUp();
            renderShop();
        }

        function renderShop() {
            ui.shop.innerHTML = "";
            game.items.forEach((item, idx) => {
                const el = document.createElement('div');
                el.className = "item" + (game.money >= item.cost ? " can-buy" : "");
                el.innerHTML = `
                    <div class="item-img"><img src="${item.img}"></div>
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-cost">${item.cost.toLocaleString()}ì›</div>
                    </div>
                    <div class="item-count">x${item.count}</div>
                `;
                el.onclick = () => buyItem(idx);
                ui.shop.appendChild(el);
            });
        }

        function buyItem(idx) {
            const item = game.items[idx];
            if(game.money >= item.cost) {
                game.money -= item.cost;
                item.count++;
                item.cost = Math.floor(item.cost * 1.5);
                playSound(audio.coin); // ë™ì „ ì†Œë¦¬ ì¬ìƒ
                saveGame();
                updateUI();
            }
        }

        // í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('clickTarget').addEventListener('mousedown', (e) => {
            let mps = game.items.reduce((acc, item) => acc + (item.val * item.count), 0);
            let clickVal = 1 + (mps * 0.05); // í´ë¦­ë‹¹ íš¨ìœ¨ ì¦ê°€
            
            game.money += clickVal;
            game.totalMoney += clickVal;
            
            playSound(audio.click); // í´ë¦­ ì†Œë¦¬ ì¬ìƒ
            updateUI();

            // í”Œë¡œíŒ… í…ìŠ¤íŠ¸ íš¨ê³¼
            const float = document.createElement('div');
            float.className = 'float-num';
            float.innerText = "+" + Math.floor(clickVal);
            float.style.left = (e.clientX - 20) + 'px';
            float.style.top = (e.clientY - 50) + 'px';
            document.body.appendChild(float);
            setTimeout(() => float.remove(), 800);
        });

        // ìë™ ì €ì¥ ë° ë£¨í”„
        setInterval(() => {
            let mps = game.items.reduce((acc, item) => acc + (item.val * item.count), 0);
            if(mps > 0) {
                game.money += (mps / 10);
                game.totalMoney += (mps / 10);
                updateUI();
            }
        }, 100);

        setInterval(saveGame, 5000);

        function saveGame() {
            localStorage.setItem('moneyV3', JSON.stringify(game));
        }

        function loadGame() {
            if(localStorage.getItem('moneyV3')) {
                const saved = JSON.parse(localStorage.getItem('moneyV3'));
                game = { ...game, ...saved };
                // ì•„ì´í…œ ìˆ˜ëŸ‰ ë³µêµ¬
                saved.items.forEach((sItem, i) => {
                    if(game.items[i]) {
                        game.items[i].count = sItem.count;
                        game.items[i].cost = sItem.cost;
                    }
                });
            }
            updateUI();
        }
    </script>
</body>
</html>
